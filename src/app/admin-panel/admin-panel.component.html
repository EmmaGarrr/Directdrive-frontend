<!-- File: src/app/admin-panel/admin-panel.component.html -->
<div class="admin-dashboard" [class.dark-theme]="isDarkTheme">
  <!-- Admin Header -->
  <div class="admin-header">
    <div class="admin-header-left">
      <button class="sidebar-toggle" (click)="toggleSidebar()">
        <i class="fas fa-bars"></i>
      </button>
      <h1>DirectDrive Admin Panel</h1>
      <p class="admin-subtitle">Welcome, {{ currentAdmin?.email || 'Admin' }}</p>
    </div>
    <div class="admin-header-right">
      <!-- Notification Bell -->
      <div class="notification-bell" (click)="toggleNotifications()">
        <i class="fas fa-bell"></i>
        <span class="notification-count" *ngIf="notificationCount > 0">{{ notificationCount }}</span>
      </div>
      
      <!-- Theme Toggle -->
      <button class="theme-toggle" (click)="toggleTheme()" [title]="isDarkTheme ? 'Switch to Light Mode' : 'Switch to Dark Mode'">
        <i class="fas" [class.fa-moon]="!isDarkTheme" [class.fa-sun]="isDarkTheme"></i>
      </button>
      
      <span class="admin-role-badge" [class]="'role-' + (currentAdmin?.role || 'admin')">
        {{ getRoleDisplayName(currentAdmin?.role) }}
      </span>
      <button class="btn-logout" (click)="logout()">
        <i class="fas fa-sign-out-alt"></i> Logout
      </button>
    </div>
  </div>

  <!-- Notification Dropdown -->
  <div class="notification-dropdown" *ngIf="showNotifications">
    <div class="notification-header">
      <h4>Notifications</h4>
      <button (click)="clearNotifications()" class="btn-clear">Clear All</button>
    </div>
    <div class="notification-list">
      <div *ngIf="notifications.length === 0" class="no-notifications">
        <i class="fas fa-check-circle"></i>
        <p>No new notifications</p>
      </div>
      <div *ngFor="let notification of notifications" class="notification-item" [class]="'type-' + notification.type">
        <div class="notification-icon">
          <i class="fas" [class]="getNotificationIcon(notification.type)"></i>
        </div>
        <div class="notification-content">
          <h5>{{ notification.title }}</h5>
          <p>{{ notification.message }}</p>
          <small>{{ formatTime(notification.timestamp) }}</small>
        </div>
        <button class="btn-dismiss" (click)="dismissNotification(notification.id)">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Debug Information (Hidden in Production) -->
  <!-- <div *ngIf="!environment.production" class="debug-info" style="background: #f0f0f0; padding: 1rem; margin: 0 2rem; border-radius: 8px; font-family: monospace; font-size: 0.8rem;">
    <h4>Debug Info:</h4>
    <p><strong>Current Admin:</strong> {{ currentAdmin?.email || 'Not loaded' }}</p>
    <p><strong>Role:</strong> {{ currentAdmin?.role || 'Not loaded' }}</p>
    <p><strong>Is Super Admin:</strong> {{ isSuperAdmin }}</p>
    <p><strong>Session Role:</strong> {{ adminAuthService.getCurrentAdminSession()?.adminRole || 'Not set' }}</p>
    <p><strong>Token:</strong> {{ adminAuthService.getAdminToken() ? 'Present' : 'Missing' }}</p>
  </div> -->

  <!-- Sidebar Navigation -->
  <div class="admin-sidebar" [class.collapsed]="sidebarCollapsed">
    <div class="sidebar-content">
      <!-- Dashboard Section -->
      <div class="nav-section">
        <h3><i class="fas fa-tachometer-alt"></i> Dashboard</h3>
        <div class="nav-links">
          <a routerLink="/admin-panel" class="nav-link" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}">
            <i class="fas fa-home"></i>
            <span class="nav-text">Home</span>
          </a>
          <a routerLink="/admin-panel/analytics" class="nav-link" routerLinkActive="active">
            <i class="fas fa-chart-bar"></i>
            <span class="nav-text">User Analytics</span>
          </a>
        </div>
      </div>

      <!-- User Management Section -->
      <div class="nav-section">
        <h3><i class="fas fa-users"></i> User Management</h3>
        <div class="nav-links">
          <a routerLink="/admin-panel/users" class="nav-link" routerLinkActive="active">
            <i class="fas fa-users-cog"></i>
            <span class="nav-text">Manage Users</span>
          </a>
          <a routerLink="/admin-panel/logs" class="nav-link" routerLinkActive="active">
            <i class="fas fa-list-alt"></i>
            <span class="nav-text">Activity Logs</span>
          </a>
          <a *ngIf="isSuperAdmin" routerLink="/admin-panel/create-admin" class="nav-link" routerLinkActive="active">
            <i class="fas fa-user-plus"></i>
            <span class="nav-text">Create Admin</span>
          </a>
        </div>
      </div>

      <!-- File Management Section -->
      <div class="nav-section">
        <h3><i class="fas fa-folder-open"></i> File Management</h3>
        <div class="nav-links">
          <a routerLink="/admin-panel/files" class="nav-link" routerLinkActive="active">
            <i class="fas fa-files-o"></i>
            <span class="nav-text">File Browser</span>
          </a>
        </div>
      </div>

      <!-- Storage Management Section -->
      <div class="nav-section">
        <h3><i class="fas fa-hdd"></i> Storage</h3>
        <div class="nav-links">
          <a routerLink="/admin-panel/storage" class="nav-link" routerLinkActive="active">
            <i class="fas fa-cloud"></i>
            <span class="nav-text">Google Drive</span>
          </a>
          <a routerLink="/admin-panel/backup" class="nav-link" routerLinkActive="active">
            <i class="fas fa-shield-alt"></i>
            <span class="nav-text">Backup Management</span>
          </a>
        </div>
      </div>

      <!-- System Monitoring Section -->
      <div class="nav-section">
        <h3><i class="fas fa-server"></i> System</h3>
        <div class="nav-links">
          <a routerLink="/admin-panel/monitoring" class="nav-link" routerLinkActive="active">
            <i class="fas fa-chart-line"></i>
            <span class="nav-text">Monitoring</span>
          </a>
          <a routerLink="/admin-panel/security" class="nav-link" routerLinkActive="active">
            <i class="fas fa-shield-alt"></i>
            <span class="nav-text">Security Settings</span>
          </a>
          <a routerLink="/admin-panel/logs" class="nav-link" routerLinkActive="active">
            <i class="fas fa-file-alt"></i>
            <span class="nav-text">System Logs</span>
          </a>
        </div>
      </div>

      <!-- Communication Section -->
      <div class="nav-section">
        <h3><i class="fas fa-bullhorn"></i> Communication</h3>
        <div class="nav-links">
          <a routerLink="/admin-panel/notifications" class="nav-link" routerLinkActive="active">
            <i class="fas fa-bell"></i>
            <span class="nav-text">Notifications</span>
          </a>
          <a routerLink="/admin-panel/reports" class="nav-link" routerLinkActive="active">
            <i class="fas fa-chart-bar"></i>
            <span class="nav-text">Reports & Export</span>
          </a>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="nav-section">
        <h3><i class="fas fa-bolt"></i> Quick Actions</h3>
        <div class="nav-links">
          <button class="nav-link btn-action" (click)="refreshStats()">
            <i class="fas fa-sync-alt"></i>
            <span class="nav-text">Refresh Stats</span>
          </button>
          <button class="nav-link btn-action" (click)="clearEvents()">
            <i class="fas fa-trash"></i>
            <span class="nav-text">Clear Events</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content Area -->
  <div class="admin-content" [class.sidebar-collapsed]="sidebarCollapsed">
    <!-- Router Outlet for Child Components -->
    <router-outlet></router-outlet>
    
    <!-- Dashboard Home (shown when no child route is active) -->
    <div class="dashboard-home" *ngIf="!shouldShowChildRoute()">
      <!-- Stats Overview -->
      <div class="stats-overview">
        <h2>System Overview</h2>
        <div class="stats-grid">
          <!-- Users Stats -->
          <div class="stat-card">
            <div class="stat-icon users">
              <i class="fas fa-users"></i>
            </div>
            <div class="stat-content">
              <h3>{{ systemStats.totalUsers || 0 }}</h3>
              <p>Total Users</p>
              <span class="stat-change positive" *ngIf="systemStats.userGrowth > 0">
                +{{ systemStats.userGrowth }}% this month
              </span>
            </div>
          </div>

          <!-- Files Stats -->
          <div class="stat-card">
            <div class="stat-icon files">
              <i class="fas fa-file"></i>
            </div>
            <div class="stat-content">
              <h3>{{ formatNumber(systemStats.totalFiles) || 0 }}</h3>
              <p>Total Files</p>
              <span class="stat-change">
                {{ formatSize(systemStats.totalStorage) }}
              </span>
            </div>
          </div>

          <!-- Storage Stats -->
          <div class="stat-card">
            <div class="stat-icon storage">
              <i class="fas fa-database"></i>
            </div>
            <div class="stat-content">
              <h3>{{ systemStats.storageUsagePercent || 0 }}%</h3>
              <p>Storage Used</p>
              <div class="progress-bar">
                <div class="progress-fill" [style.width.%]="systemStats.storageUsagePercent"></div>
              </div>
            </div>
          </div>

          <!-- System Health -->
          <div class="stat-card">
            <div class="stat-icon health" [class]="'status-' + systemStats.systemHealth">
              <i class="fas fa-heartbeat"></i>
            </div>
            <div class="stat-content">
              <h3>{{ getHealthStatus(systemStats.systemHealth) }}</h3>
              <p>System Health</p>
              <div class="connection-status" [class]="'status-' + (isConnected ? 'connected' : 'disconnected')">
                <i class="fas fa-circle"></i>
                {{ isConnected ? 'Connected' : 'Checking...' }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Charts Section -->
      <div class="charts-section">
        <div class="chart-container">
          <h3>Upload Activity (Last 7 days)</h3>
          <div class="chart-placeholder">
            <div class="chart-bars">
              <div *ngFor="let day of chartData.uploads; let i = index" class="chart-bar">
                <div class="bar-fill" [style.height.%]="day.percentage"></div>
                <span class="bar-label">{{ day.label }}</span>
              </div>
            </div>
          </div>
        </div>

        <div class="chart-container">
          <h3>Storage Growth</h3>
          <div class="chart-placeholder">
            <div class="storage-chart">
              <div class="storage-segment google-drive" [style.width.%]="storageDistribution.googleDrive">
                <span>Google Drive ({{ storageDistribution.googleDrive }}%)</span>
              </div>
              <div class="storage-segment hetzner" [style.width.%]="storageDistribution.hetzner">
                <span>Hetzner ({{ storageDistribution.hetzner }}%)</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Real-time Events -->
      <div class="events-container">
        <div class="events-header">
          <h3><i class="fas fa-stream"></i> Live Event Stream</h3>
          <div class="events-controls">
            <span class="event-count">{{ events.length }} events</span>
            <button class="btn-refresh" (click)="refreshEvents()">
              <i class="fas fa-sync-alt"></i>
            </button>
          </div>
        </div>
        
        <div class="log-container">
          <div *ngIf="events.length === 0" class="no-events">
            <i class="fas fa-info-circle"></i>
            <p>No events yet. System events will appear here in real-time.</p>
          </div>
          
          <div *ngFor="let event of events.slice(0, 10); trackBy: trackEvent" class="log-entry">
            <div class="event-time">{{ getEventTime(event) }}</div>
            <div class="event-message">{{ event }}</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>